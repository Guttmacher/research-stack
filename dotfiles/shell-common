# R
## R library path configuration
## Add system-wide R library directory to R's library search path
export R_LIBS_SITE="/usr/local/lib/R/site-library"

## Configure renv to use external libraries
export RENV_CONFIG_EXTERNAL_LIBRARIES="/usr/local/lib/R/site-library"

## Enable renv install shortcuts for faster package installation
export RENV_CONFIG_INSTALL_SHORTCUTS="TRUE"

## Rscript alias
alias Rs='Rscript'
alias R='R --no-save --no-restore'

# Aliases for improved command-line tools
alias bat='batcat'  # Ubuntu installs bat as batcat to avoid naming conflicts
alias ls='eza'
alias lls='eza --long -h --git --git-repos -s modified'
alias ll='eza --long -h --git --git-repos'
alias l='eza --long -h --git --git-repos -d .*'
alias la='eza -a'
alias dir='eza -lh --git --git-repos'

# Git aliases
alias g='git'
alias gs='git status'
alias gst='git status'
alias gsh='git show'
alias gd='git diff'
alias gdc='git diff --cached'
alias ga='git add'
alias g.='git add .'
alias gc='git commit'
alias gca='git commit -a'
alias gco='git checkout'
alias gsw='git switch'
alias gb='git branch'
alias gbr='git branch'
alias gp='git push'
alias gpu='git push'
alias gpl='git pull'
alias gl='git log'
alias glg='git log --oneline --graph --decorate'
alias gsu='git submodule update --init --recursive'
alias gcl='git clone --recurse-submodules -j8'

# Neovim aliases
alias vim='nvim'
alias vi='nvim'

# Functions
# Smart tmux session management
# - Attaches to existing session in current directory if found
# - Creates new session with abbreviated path name if none exists
# - Path abbreviation: parent dirs use fish-style (consonants only), working dir keeps full name
# Usage: t (no arguments needed)
t() {
  local current_dir="$PWD"
  local full_path="${PWD##/Users/$USER/}"
  local session_name=""
  
  # Check for existing sessions in this directory
  local existing_session=$(tmux list-sessions -F "#{session_name} #{session_path}" 2>/dev/null | grep " ${current_dir}$" | head -1 | cut -d' ' -f1)
  
  if [[ -n "$existing_session" ]]; then
    # Attach to existing session
    tmux attach -t "$existing_session"
    return
  fi
  
  # Create abbreviated session name
  if [[ "$full_path" == */* ]]; then
    # Split path into directories
    local path_parts=(${(s:/:)full_path})
    local last_dir="${path_parts[-1]}"
    
    # Abbreviate all directories except the last one
    for ((i=1; i<${#path_parts[@]}; i++)); do
      local dir="${path_parts[i]}"
      # Fish-style abbreviation: first letter + consonants, drop vowels
      local abbrev=$(echo "$dir" | sed 's/\(.\).*/\1/' | tr '[:upper:]' '[:lower:]')$(echo "$dir" | sed 's/^.//' | sed 's/[aeiouAEIOU]//g' | tr '[:upper:]' '[:lower:]')
      session_name+="$abbrev/"
    done
    session_name+="$last_dir"
  else
    session_name="$full_path"
  fi
  
  # Sanitize session name: keep only alphanumeric, periods, underscores, dashes, and forward slashes
  session_name=$(echo "$session_name" | sed 's/[^a-zA-Z0-9._/-]//g')
  
  tmux new -ADs "$session_name"
}
